<!DOCTYPE html>
<html>
<title>Franky M5SF</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="w3.css">

<head>
<script type="text/javascript" src="websocket.js"></script>
</head>

<script>

var delimiter = "|";

function validateIPaddress(string, error) {
	var input = document.getElementById(string);
	var result = document.getElementById(error);
	var error = false;
	
	var bytes = input.value.split(".");
	if (bytes.length != 4) {
		error=true;
	} else {
		var newValue = "";
		for (var i=0; i<4; i++) {
			if (isNaN(parseInt(bytes[i]))) {
				error=true;
				break;
			}
			bytes[i] = parseInt(bytes[i]);
			if (bytes[i] < 0 || bytes[i] > 255) {
				error = true;
				break;
			}
			newValue += bytes[i];
			if (i<3) newValue += ".";
		}
	}
	if (error) {
		result.innerHTML = "Ung&uuml;ltige Adresse";
	} else {
		input.value = newValue;
		connection.send(string + delimiter + newValue);
		result.innerHTML = "";
	}
}
 
function confirmChange(string) {
	var input = document.getElementById(string);	
	connection.send(string + delimiter + input.value);
} 

function confirmModelTimeChange(string, field) {
	var input = document.getElementById(string);
	var computation = document.getElementById(field);	
	var scale = Math.floor(60/input.value);
	computation.innerHTML = "(Eine Fahrplanminute vergeht in " + scale + " Sekunden)";
	connection.send(string + delimiter + input.value);
}

</script>

<body>

<div class="w3-container"> 
	<!-- https://www.w3schools.com/w3css/w3css_buttons.asp -->
	<a href="system.html" class="w3-btn w3-round-large w3-wide w3-teal w3-hover-gray">System</a>
	<a href="z21.html" class="w3-btn w3-round-large w3-wide w3-teal w3-hover-gray">Z21</a>
	<a href="sniffer.html" class="w3-btn w3-round-large w3-wide w3-teal w3-hover-gray">X-Bus</a>
	<a href="config.html" class="w3-btn w3-round-large w3-wide w3-teal w3-hover-gray">Einstellungen</a>
	<a href="about.html" class="w3-btn w3-round-large w3-wide w3-teal w3-hover-gray">&Uuml;ber</a>
</div>

<div class="w3-panel w3-gray"><h1>Einstellungen</h1></div> 

<i>(Gespeichert wird nach Enter bzw. Fokuswechsel.)</i>

<div class="w3-container">
	<h2>Adressen</h2>
	<div class="w3-card-4">
		<div class="w3-container w3-leftalign">
			<ul class="w3-ul w3-hoverable">
			<li>Z21-Adresse <input id="z21IP" type="text" maxlength="15" size="14" value="%z21IP%" onchange="validateIPaddress('z21IP', 'z21IP_')"/> <font color="red" id="z21IP_"></font></li>		
			</ul>
		</div>
	</div>
</div>

<div class="w3-container">
	<h2>Modellzeit</h2>
	<div class="w3-card-4">
		<div class="w3-container w3-leftalign">
			<ul class="w3-ul w3-hoverable">
			<li>Uhrzeit <input id="modelTime" type="time" maxlength="5" size="6" value="%modelTime%" onchange="confirmChange('modelTime')"/> 
			    - Zeitraffungsfaktor <input id="modelTimeScale" type="number" maxlength="2" size="2" min="1" max="12" value="%modelTimeScale%" onchange="confirmModelTimeChange('modelTimeScale', 'modelTimeScaleComputed')" /> <font id="modelTimeScaleComputed"></font></li>			
			<li><input id="minuteBeep" type="checkbox" value="%minuteBeep%"/>  Tonsignal jede Minute, Frequenz 
			    <input type="text" maxlength="4" size="2"/>Hz, Dauer <input type="text" maxlength="4" size="2"/>ms</li>	
			</ul>
			</ul>
		</div>
	</div>
</div>

<div class="w3-container">
	<h2>Pushover</h2>
	<div class="w3-card-4">
		<div class="w3-container w3-leftalign">
			<ul class="w3-ul w3-hoverable">
			<li>API Token <input id="poAPIToken" type="text" size="30" value="%poAPIToken%" onchange="confirmChange('poAPIToken')"/> 
			User Key <input id="poUserKey" type="text" size="30" value="%poUserKey%" onchange="confirmChange('poUserKey')"/>
			<a href="https://pushover.net/">https://pushover.net/</a>
			</li>		
			</ul>
		</div>
	</div>
</div>

</body>
</html>
